# GitHub Actions Workflows Guide

This repository includes automated CI/CD pipelines for building, testing, and deploying the Timetable Management System.

## üîÑ Available Workflows

### 1. **Flutter Web Deploy** (`flutter-web-deploy.yml`)

Automatically builds and deploys the Flutter web app to GitHub Pages.

**Triggers:**
- Push to `main` branch
- Pull requests to `main`
- Manual trigger via workflow_dispatch

**Actions:**
- Install Flutter
- Run tests
- Build web app
- Deploy to GitHub Pages

**Setup:**
1. Enable GitHub Pages in repository settings
2. Set source to `gh-pages` branch
3. Access at: `https://your-username.github.io/time-table-app/`

---

### 2. **Android APK Release** (`android-release.yml`)

Creates GitHub releases with Android APK builds.

**Triggers:**
- Git tags matching `v*` (e.g., `v1.0.0`)
- Manual trigger with version input

**What it builds:**
- Universal APK (~50 MB) - Works on all devices
- ARM64 APK (~20 MB) - Modern devices
- ARMv7 APK (~20 MB) - Older devices  
- x86_64 APK (~20 MB) - Emulators

**How to create a release:**

```bash
# Method 1: Using Git Tags
git tag -a v1.0.0 -m "Release version 1.0.0"
git push origin v1.0.0

# Method 2: Manual trigger
# Go to Actions ‚Üí Android APK Release ‚Üí Run workflow
```

**Release includes:**
- All APK variants
- Installation instructions
- Admin credentials
- Feature list
- System requirements

---

### 3. **Backend CI/CD** (`backend-ci-cd.yml`)

Tests and deploys backend to Render.

**Triggers:**
- Push to `main` with backend changes
- Pull requests affecting backend
- Manual trigger

**Actions:**
- Run tests
- Lint code
- Deploy to Render (production)
- Verify deployment health

**Setup for Render deployment:**
1. Go to repository Settings ‚Üí Secrets ‚Üí Actions
2. Add `RENDER_DEPLOY_HOOK` secret:
   - Get from Render Dashboard ‚Üí Service ‚Üí Settings ‚Üí Deploy Hook
   - Example: `https://api.render.com/deploy/srv-xxxxx?key=xxxxx`

---

### 4. **Flutter CI** (`flutter-ci.yml`)

Continuous integration for Flutter app quality checks.

**Triggers:**
- Push to `main` or `develop` with Flutter changes
- Pull requests
- Manual trigger

**Actions:**
- Code formatting check
- Static analysis
- Run unit tests
- Check for outdated packages

---

## üöÄ Quick Start

### Enable GitHub Actions

1. Push workflows to GitHub:
```bash
git add .github/workflows/
git commit -m "Add GitHub Actions workflows"
git push
```

2. Workflows run automatically based on triggers

3. View in GitHub: **Actions** tab

---

## üìã Setup Checklist

### For Web Deployment:
- [ ] Enable GitHub Pages (Settings ‚Üí Pages)
- [ ] Set source to `gh-pages` branch
- [ ] Update `base-href` in workflow if needed

### For Android Releases:
- [ ] Ensure Flutter app builds locally
- [ ] Update production API URL in workflow
- [ ] Create release tag or use manual trigger

### For Backend Deployment:
- [ ] Deploy backend to Render
- [ ] Add `RENDER_DEPLOY_HOOK` secret
- [ ] Verify API health endpoint exists

### For Flutter CI:
- [ ] Ensure tests exist in `flutter_app/test/`
- [ ] Fix any analyzer warnings
- [ ] Format code: `flutter format .`

---

## üéØ Creating Your First Release

### Step 1: Prepare Release

```bash
# Update version in pubspec.yaml
version: 1.0.0+1

# Test locally
cd flutter_app
flutter build apk --release
```

### Step 2: Create Release Tag

```bash
# Commit all changes
git add .
git commit -m "Prepare release v1.0.0"
git push

# Create and push tag
git tag -a v1.0.0 -m "Release v1.0.0 - Initial production release"
git push origin v1.0.0
```

### Step 3: Monitor Build

1. Go to **Actions** tab
2. Click on **Android APK Release** workflow
3. Watch build progress (~10-15 minutes)

### Step 4: Download Release

1. Go to **Releases** section
2. Find `v1.0.0` release
3. Download APK files
4. Share with users!

---

## üîê Required Secrets

Add these in: **Settings ‚Üí Secrets ‚Üí Actions**

| Secret Name | Description | Required For |
|------------|-------------|--------------|
| `RENDER_DEPLOY_HOOK` | Render deployment webhook URL | Backend deployment |
| `GITHUB_TOKEN` | Auto-generated by GitHub | All workflows (automatic) |

---

## üìä Workflow Status Badges

Add to your README.md:

```markdown
![Flutter CI](https://github.com/your-username/time-table-app/workflows/Flutter%20CI/badge.svg)
![Android Release](https://github.com/your-username/time-table-app/workflows/Android%20APK%20Release/badge.svg)
![Backend CI/CD](https://github.com/your-username/time-table-app/workflows/Backend%20CI%2FCD/badge.svg)
```

---

## üêõ Troubleshooting

### Build fails with "out of space"
- GitHub runners have limited disk space
- Remove unnecessary dependencies
- Use `flutter clean` before build

### APK not uploaded to release
- Check if all APK paths are correct
- Verify build completed successfully
- Ensure `GITHUB_TOKEN` has required permissions

### Backend deployment fails
- Verify `RENDER_DEPLOY_HOOK` secret is correct
- Check Render service is active
- Review Render deployment logs

### Web deployment 404
- Enable GitHub Pages
- Set source to `gh-pages` branch
- Wait 2-3 minutes for deployment

---

## üé® Customization

### Change production API URL:
Edit `android-release.yml`:
```yaml
run: |
  sed -i "s|http://localhost:5000/api|https://your-api.com/api|g" lib/services/api_service.dart
```

### Add custom domain for web:
Edit `flutter-web-deploy.yml`:
```yaml
cname: your-domain.com
```

### Modify APK build variants:
Edit `android-release.yml`:
```yaml
run: flutter build apk --release --target-platform android-arm64
```

---

## üìà Best Practices

1. **Version Numbering:**
   - Follow semantic versioning: `MAJOR.MINOR.PATCH`
   - Example: `1.2.3` ‚Üí `1.2.4` (bug fix)

2. **Testing:**
   - Always run `flutter test` locally before pushing
   - Fix analyzer issues before creating releases

3. **Releases:**
   - Write clear release notes
   - Include changelog
   - Mention breaking changes

4. **Security:**
   - Never commit API keys or secrets
   - Use GitHub Secrets for sensitive data
   - Rotate deploy hooks periodically

---

## üìö Additional Resources

- [GitHub Actions Documentation](https://docs.github.com/actions)
- [Flutter CI/CD Guide](https://docs.flutter.dev/deployment/cd)
- [Render Deployment Guide](https://render.com/docs/deploys)

---

## ‚úÖ Verification

After setup, verify:

- [ ] Workflows appear in Actions tab
- [ ] Green checkmarks on successful builds
- [ ] Releases created automatically with APKs
- [ ] Web app accessible via GitHub Pages
- [ ] Backend deploys to Render on push

---

**Need help?** Check the workflow logs in the Actions tab or create an issue!
